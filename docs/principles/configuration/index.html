<!DOCTYPE html>
<html lang="en-US">

<head>
    <title>Michael Knapp&#39;s Home Page</title>
    <meta charset="UTF-8">
    <meta name="description" content="Portfolio site for Michael Knapp">
    <meta name="keywords" content="golang resume">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/website/css/site.css">
    <link rel="stylesheet" href="/website/css/footer.css">
    <link rel="stylesheet" href="/website/css/content.css">
    <link rel="stylesheet" href="/website/css/listnav.css" />
    <link rel="stylesheet" href="/website/css/breadcrumbs.css" />
    <link rel="stylesheet" href="/website/css/sitenav.css" />
    <link rel="stylesheet" href="/website/css/sectionmenu.css" />
    <link rel="stylesheet" href="/website/css/tocmenu.css" />

    <link rel="stylesheet" media="print" href="/website/css/print.css" />
</head>

<body><div class="sitenav">
    <h2 class="sitenav">Sections</h2>
    <nav class="sitenav">
        <ul>
            <li class="sitenav ">
                <a class="sitenav " href="/"><img src="/website/icons/house.png"
                        width="20px" /></a>
            </li>
            
            <li class="sitenav currentsection">
                <a class="sitenav currentsection"
                    href="/website/principles/" title="my description.">
                    Principles</a>
            </li>
            <li class="sitenav">
                <a class="sitenav"
                    href="/website/reliability/" title="robust software system design">
                    Reliability</a>
            </li>
            <li class="sitenav">
                <a class="sitenav"
                    href="/website/architecture/" title="robust software system design">
                    Architecture</a>
            </li>
            <li class="sitenav">
                <a class="sitenav"
                    href="/website/algorithms/" title="Software algorithms.">
                    Algorithms</a>
            </li>
            <li class="sitenav">
                <a class="sitenav"
                    href="/website/tech/" title="Notes about software engineering.">
                    Tech</a>
            </li>
            <li class="sitenav">
                <a class="sitenav"
                    href="/website/blog/" title="A blog on software engineering.">
                    Blog</a>
            </li>
            <li class="sitenav">
                <a class="sitenav"
                    href="/website/cheat-sheets/" title="Software engineering cheat sheets.">
                    Cheat Sheets</a>
            </li>
        </ul>
    </nav>
</div>
    <div class="body"><aside>
    <h2 class="sectionmenu">Pages</h2>
    <ul class="sectionmenu">
        
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/kiss/" title="How to keep your code simple">
                KISS and YAGNI</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/dry/" title="">
                Don&#39;t Repeat Yourself</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/defensive/" title="Making your code defensive.">
                Defensive Programming</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/single-responsibility/" title="The importance of single responsibility.">
                Single Responsibility Principle</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/open-closed/" title="">
                Open Closed Principle</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/substitution/" title="">
                Substitution</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/segregation/" title="explaining the interface segregation principle">
                Interface Segregation Principle</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/testing/" title="The importance of software testing.">
                Software Testing</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu currentpage"
                href="/website/principles/configuration/" title="">
                Configuration Levels</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/quality/" title="Assessing code quality.">
                Judging Quality</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/stereotypes/" title="">
                Class Stereotypes</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/ybyo/" title="">
                You Build You Own</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/globals/" title="">
                Globals</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/optimization/" title="">
                Premature Optimization</a>
        </li>
        <li class="sectionmenu">
            <a class="sectionmenu"
                href="/website/principles/reinvent/" title="">
                Don&#39;t Reinvent the Wheel</a>
        </li>
    </ul>
</aside><div class="rightcolumn">
        <div class="rightcontent">
                <div class="tocmenu arrow"><a class="tocmenu arrow" href="/website/principles/testing/"
                                title="Software Testing">
                                <img src="/website/icons/arrow-left-circle-white.png" class="tocmenu arrow" /></a><a class="tocmenu arrow" href="/website/principles/" title="Software Development Principles">
                                <img src="/website/icons/arrow-up-circle-white.png" class="tocmenu arrow" /></a>
                        <a class="tocmenu arrow" href="/website/principles/quality/"
                                title="Judging Quality"><img src="/website/icons/arrow-right-circle-white.png"
                                        class="tocmenu arrow" /></a>
                </div>
                <hr class="tocmenu">
                <p class="tocmenu">Table of Contents:</p><nav id="TableOfContents">
  <ul>
    <li><a href="#hard-coded">Hard Coded</a></li>
    <li><a href="#environment-variables">Environment Variables</a></li>
    <li><a href="#command-line-arguments">Command Line Arguments</a></li>
    <li><a href="#configuration-files">Configuration Files</a></li>
    <li><a href="#expressions">Expressions</a></li>
    <li><a href="#templates">Templates</a></li>
    <li><a href="#embedded-scripts">Embedded Scripts</a></li>
    <li><a href="#configurable-endpoints">Configurable Endpoints</a></li>
    <li><a href="#why-is-this-needed">Why Is This Needed?</a></li>
  </ul>
</nav>
        </div>
</div>
        <div class="middlecolumn"><div class="breadcrumbs">
    <h2 class="breadcrumbs">BreadCrumbs</h2>
    <ul class="breadcrumbs">
        <li class="breadcrumbs"><a href="/website/" class="breadcrumbs">/Michael Knapp&#39;s Home Page</a></li>
        <li class="breadcrumbs"><a href="/website/principles/" class="breadcrumbs">/Principles</a></li>
    </ul>
</div>
            <article>
                <main>
                    <h1 class="title">Configuration Levels</h1>
<p>This is not a principle often taught in software engineering, it is just something I learned through
experience.  An engineers performance is often judged by how quickly they can deliver results,
and that in turn will depend a lot on how easy it is for the code to be updated.  One way for
code to be easy to maintain and update is with loose coupling.  Another is to add ample controls
over how it operates from its configuration, which is what this page discusses.</p>
<p>There is a wide spectrum of control that a team could have over their applications.  Let&rsquo;s go through them.</p>
<h1 id="hard-coded">Hard Coded</h1>
<p>When an application is first written, critical variables are frequently coded right into the spot they are used.
For example, a value could be written inline at the very function it is used.  The situation gets slightly better
as they move this variable to more visible places, like to a class&rsquo;s arguments, or to a file holding constants.
But in any case, the value cannot change unless the program is re-built.  This is really tough to maintain
going forward.</p>
<h1 id="environment-variables">Environment Variables</h1>
<p>One step up, you get a little more control when a variable is set by an environment variable.  At least it can
be changed now without re-building the code, but it still has some challenges.</p>
<p>First, environment variables are globals.  Generally speaking, global variables should be avoided in
software engineering.  They are difficult to test with because they are mutable, and the order that tests
run in is not guaranteed.</p>
<p>Another problem with environment variables is they are often not documented for users.</p>
<h1 id="command-line-arguments">Command Line Arguments</h1>
<p>Passing a variable in as a command line argument has at least some advantages over environment variables.
For one thing, it is usually part of the help documentation presented by the command line, so other
engineers will be aware of it.  Also, in the code it is not a global, so you don&rsquo;t need to worry about
it being modified by different places or threads in the code.</p>
<p>It still lacks some control though.  Command line arguments can get quite verbose as they are more
heavily used.  The values would show up in a &ldquo;ps&rdquo; command, and maybe they shouldn&rsquo;t really.  The value
cannot change over the life of the process, and you might want to change it.  It can also be
difficult to see the whole way the application is configured when command line arguments are used.</p>
<h1 id="configuration-files">Configuration Files</h1>
<p>Using a configuration file brings some pros and cons along with it.</p>
<p>Pros:</p>
<ul>
<li>You can update this file while the program is running, and depending on how you wrote the application, it could pick up that change promptly.</li>
<li>It is easy to see the whole configuration of the application in one place.</li>
<li>The values are not shown on the &ldquo;ps&rdquo; output.</li>
</ul>
<p>Cons:</p>
<ul>
<li>Now this file must be written, and in the correct place on the file system.  The runtime user must be granted permission to read it.</li>
<li>If it is included in a docker image, that can make it very difficult to change the configuration.  I recommend mounting the configuration into the runtime container.</li>
<li>In Kubernetes, you would need to write a ConfigMap, and have that properly mounted, for the container and application to use this configuration.</li>
</ul>
<p>So we have gradually gained more control over this variable with each option.  Still, we basically have a <em>constant</em>
variable, that cannot fundamentally change the business logic of the application.  It grants us somewhat
limited control over things.</p>
<h1 id="expressions">Expressions</h1>
<p>To gain more control, an expression can be used in the configuration instead of a hard coded value.
There are often a variety of expression languages that can be supported or embedded into configuration.
For Golang, &ldquo;expr&rdquo; is a very robust option, but there is also &ldquo;gval&rdquo; and others.  Regex can also count.</p>
<p>Switching to expressions means that the value of a variable can depend on the current request being processed.
Another huge benefit is that it can easily be changed without ever re-building the application.</p>
<p>There are some downsides to using expressions:</p>
<ul>
<li>Now you have a possible runtime failure instead of compile time.</li>
<li>Fellow engineers might be unfamiliar with the expression&rsquo;s syntax.
<ul>
<li>They may be unable to write new expressions or explain what it means.</li>
</ul>
</li>
<li>They may not perform as fast as constants or other options.</li>
</ul>
<p>It&rsquo;s important to note that, despite not needing to re-build the application, these expressions
<em>do need to be tested!</em></p>
<h1 id="templates">Templates</h1>
<p>Expressions gave us a lot of control over how values can be selected for each request, but they can
be unwieldly when you have entire objects to define.  Templates give you enough control
to specify how entire objects are built for each request.  So they give you a huge deal more
control than just expressions.  They have similar down-sides as expressions.  They could
also have slow performance, you should weigh that against the needs of the current function.</p>
<h1 id="embedded-scripts">Embedded Scripts</h1>
<p>Templates give us a ton of control, but they are not exactly turing complete languages.  There
are complex functions we might want to add that templates just cannot help with.</p>
<p>So to gain the utmost control over business logic, applications could add support for embedded
scripting languages.  Lua is a great example, your application configuration could refer to a
Lua script that might be invoked for each request.  This would make it possible for even
very high level business logic to change without ever re-building the application.</p>
<p>This practice is related to the Open/Closed principle, which states that software components
should be open to extension, and closed to modification.  In this case, the service permits
extension via the embedded scripting language.</p>
<p>There are some extra down-sides to supporting embedded scripts:</p>
<ul>
<li>These tend to perform much more slowly than application source code.  You will need to
consider the performance requirements of the service here.</li>
<li>They also need to be unit tested.</li>
<li>It is another case of something that might fail at runtime instead of compile time.</li>
<li>They can be complicated and unfamiliar to other engineers.</li>
</ul>
<p>Another major drawback and concern of embedded scripts, is that corporate governance might
have an issue with them.  Some companies only permit certain languages be used, because
they have security scanners for them.  It might be impossible to run any security scan
on these scripts.  You could argue that it&rsquo;s actually the lower level language running it,
but who knows if that will be accepted.</p>
<h1 id="configurable-endpoints">Configurable Endpoints</h1>
<p>Similar to the principles above, your service&rsquo;s high level endpoints should be completely
changeable from configuration.  You should be able to add or remove any number of new
endpoints to your service from configuration alone.</p>
<p>This might also be called &ldquo;configuration driven development&rdquo;, but I&rsquo;m unsure if it
is the same thing.</p>
<h1 id="why-is-this-needed">Why Is This Needed?</h1>
<p>You might feel like, what&rsquo;s wrong with just updating the source code, re-building, and re-deploying?
There are a few issues:</p>
<ul>
<li>Often times your CICD process can take tens of minutes to complete.  If you wait all of that
time to discover a failure, that is a very slow iteration cycle.  You will certainly not
be very productive if you need to wait 20 minutes to test every change you make.</li>
<li>Peer reviews on pull requests might be hard to get.  Fellow engineers are also working
on their own stories, and don&rsquo;t want to be distracted trying to understand your
unfamiliar code.</li>
<li>Re-deploying can be much more risky than just changing configuration.  Rollback of
configuration is likewise easier than rolling back the application version.</li>
</ul>
<p>Following this pattern of control from configuration means you can develop new
features and changes, and test them, much more rapidly than before.</p>


                </main>
            </article><hr class="footerline">
<footer>
    <a class="footerprevious" href="/website/principles/testing/" title="Software Testing">
        <img src="/icons/arrow-left-circle-black.png" class="footerarrow arrow" /><span class="footerlinktext">
            previous</span></a>
    <div class="footermiddle">
        <div class="lastmod">Last Modified: <time datetime="2023-03-24 00:00:00 &#43;0000 UTC">
                March 24, 2023</time></div>
        <b>&#169; 2023 Michael Knapp</b>
    </div>
    <a class="footernext" href="/website/principles/quality/" title="Judging Quality">
        <span class="footerlinktext">next </span>
        <img src="/icons/arrow-right-circle-black.png" class="footerarrow arrow" /></a>
</footer>
        </div>
    </div>
</body>

</html>